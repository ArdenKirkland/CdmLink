var searchUrl = 'cdm-link/index/search/collection';
jQuery(document).ready(implementSearch);

function implementSearch() {

    jQuery('cdm-search-div').after('cdmcollection');

    jQuery('#cdm-search-button').click(function(e){
	e.preventDefault();
	console.log('clicked');
	jQuery('#cdm-preview').html('<h3>Searching...</h3><p>Retrieving documents containing your search terms. For large datasets, this could take a minute. Thanks for your patience.</p>');

	searchTerm = jQuery('#cdm-search-box').val();
	collection = jQuery('#cdmcollection').val();
	console.log(searchUrl+collection+'/search/'+searchTerm);
	jQuery.get(
	    searchUrl+collection+'/search/'+searchTerm,
	    function(jsonData) {
		data = jQuery.parseJSON(jsonData);
		if(data.length > 0) {
		    jQuery('#cdm-preview').html('<div id="select-buttons"><button id="select-all" class="select-button">Select All</button><button id="select-none" class="select-button">Select None</button></div><label id="numDocLi">'+data.length+' Documents <div style="font-size:0.8em"></div></label><br><ul id="preview-list"></ul>');
		}else {
		    jQuery('#cdm-preview').html('<h3>No Results</h3><p>Your search returned no results.</p>');
		    return;
		}
		jQuery.each(data,function(index,value) {
		    prevLi = '<li id="preview-'+value['pointer']+'">';
		    prevLi += '<input type="checkbox" class="import-check" checked="checked" name="cdm-import-items[]" value="'+value['pointer']+'" />';
		    prevLi += '<img src="'+encodeURI(value['thumbnail'])+'?path=%2Fviews%2Fitem%5B3%5D%2Fcontent" />';
		    prevLi += "<p>"+value['title']+"</p>";
		    prevLi += "</li>";
		    jQuery('#preview-list').append(prevLi);

		});
	    }
	    );
	
	});
}

function bindButtonActions() {
    jQuery('#select-all').click(function(e) {
	e.preventDefault();
	jQuery('.import-check').prop('checked',true);
    });
    jQuery('#select-none').click(function(e) {
	e.preventDefault();
	jQuery('.import-check').attr('checked',false);
    });

}
